# Создание кластера в VKCloud

## Создание кластера

![master01](vk/vk-01.png "Мастер 01")

![master01](vk/vk-02.png "Мастер 01")

С первого раза не получилось, решался вопрос через тех.поддержку

![master01](vk/vk-04.png "Мастер 01")

### Ответ техподдержки

> на текущий момент есть визуальная ошибка при создании каждой БД, в итоге создание завершается успешно. Разработчики в курсе этой проблемы, решение будет в ближайшее время.

после общения с тех.поддержкой и повторного создания - получилось создать и присоедениться

![master01](vk/vk-06.png "Мастер 01")

Подключение к БД по publci IP возможно сразу, требуется править правила firewall

![master01](vk/vk-sec-def.png "Мастер 01")

Установлено ограничение только с домашнего IP

![master01](vk/vk-sec-changed.png "Мастер 01")

По умолчанию - **accept all**, чтобы закрыть доступ **ВСЕМ** нужно придумать какое-то "левое" правило, удаление всех правил на входящий трафик приводит к полному доступу на **все порты для всех**

## Реплика и масштабирование

### в отличие от ЯО, для доступа к read-only реплике ее нужно создать, поддерживается множество реплик в разных зонах (3 зоны)

![master01](vk/vk-07.png "Мастер 01")

### Реплика создана, доступ только на чтение

выполнение операций на мастере

![master01](vk/vk-08.png "Мастер 01")

выполнение операций на реплике

![master01](vk/vk-10.png "Мастер 01")

### Горизонтальное масштабирование с Single в Cluster не поддерживается (не найдено в документации и в консоли)

## Создание кластера из 3х нод

![master01](vk/vk-cl-01.png "Мастер 01")

![master01](vk/vk-cl-02.png "Мастер 01")

![master01](vk/vk-cl-03.png "Мастер 01")

И снова визуализируется ошибка, просто ждем

![master01](vk/vk-cl-04.png "Мастер 01")

и после ожидания

![master01](vk/vk-cl-05.png "Мастер 01")

подключаемся

![master01](vk/vk-cl-06.png "Мастер 01")

меняем мастера

![master01](vk/vk-cl-07.png "Мастер 01")

ждем

![master01](vk/vk-cl-08.png "Мастер 01")

и проверяем

![master01](vk/vk-cl-09.png "Мастер 01")

# Создание и работа с кластером PostgreSQL в Google Cloud platform

## Создание инстанса

мастер проводит по шагам, ничего сложного нет.

Особенность:

- получаем суперпользователя postgres, и полный доступ к СУБД.
- тонкая настройка ресурсов - от одного vCPU

![master01](google/google-pg-01.png "Мастер 01")

![master02](google/google-pg-02.png "Мастер 02")

![master03](google/google-pg-03.png "Мастер 03")

![master04](google/google-pg-04.png "Мастер 04")

![master05](google/google-pg-05.png "Мастер 05")

### Создание

![master06](google/google-pg-06.png "Мастер 06")

![master07](google/google-pg-07.png "Мастер 07")

### Инстансе создавался долго (субъективно), выполнен backup

![master08](google/google-pg-08.png "Мастер 08")

## Подключение к инстансу

параметры подключения понятны

![master07](google/google-connection-params.png "Мастер 07")

по умолчанию кластер не доступен - порт 5432 закрыт

![master07](google/google-block-address.png "Мастер 07")

нужно добавить авторизованные сети в свойствах инстанса (**Connections** -> **Networking** -> **Authorized networks**)

![master07](google/google-add-address.png "Мастер 07")

Порт открыт

![master07](google/google-open-address.png "Мастер 07")

Доступ к БД есть

![master07](google/google-connect-success.png "Мастер 07")

Создаем БД через **psql**

![master07](google/create-database.png "Мастер 07")

Или можно создать через WEB-консоль

![master07](google/create-database-console.png "Мастер 07")

## Отказоустойчивость и доступность

Изначально инстанс создавался как **Not highly available**

Добавление простое - добавляем зону, и ждем создание хоста инстанса в другой зоне минут 10 (зависит от размера БД)

![master07](google/zones.png "Мастер 07")

## Реплика

### в отличие от ЯО, для доступа к read-only реплике ее нужно создать, поддерживается множество реплик в разных регионах и зонах

![master07](google/replicas.png "Мастер 07")

- создаем реплику, задаем параметры

![master07](google/replicas-01.png "Мастер 07")

- получаем реплику

![master07](google/replicas-02.png "Мастер 07")

- параметры подключения к реплике

![master07](google/replicas-03.png "Мастер 07")

- подключение к реплике

![master07](google/replicas-05.png "Мастер 07")

# Создание кластера в SberCloud

## Создание кластера

отказоустойчивый кластер не поддерживается, создание с "мастером" простое.

![master07](sber/sber-01.png "Мастер 07")

![master07](sber/sber-02.png "Мастер 07")

![master07](sber/sber-03.png "Мастер 07")

тюнинг "тонкий"

![master07](sber/sber-04.png "Мастер 07")

![master07](sber/sber-05.png "Мастер 07")

![master07](sber/sber-06.png "Мастер 07")

И ошибка, надо идти в поддержку вероятно

![master07](sber/sber-07.png "Мастер 07")

Со второй попытки - ошибка

![master07](sber/sber-08.png "Мастер 07")

Чат оперативно не решил

![master07](sber/sber-09.png "Мастер 07")

## Сыроватое решение, как кажется... (работал в Evolution, а оно обрезанное)

## Обновление

Получил ответ из тех.поддержки
> Пожалуйста, создайте ВМ в AZ1 и пересоздайте кластер. Вы сможете сразу удалить ВМ, это необходимо лишь для инициализации стандартных ресурсов.

## Резюме: жду подключение Advanced платформы

> Точных сроков нет, все заявки рассматриваются в порядке очереди. Ожидайте, с мы с вами свяжемся

# Sber Cloud Advance

Решение понравилось больше всего, тк все не очевидно, но "мощно", довольно близко к Google Cloud Platform.

Но требует изучения и более глубоко погружения.

Получаем реальное решение, с виртуалками "под капотом", выделенные сервера БД, нормальную сеть с настройкой множества параметров, создание множества реплик под решение тяжелых задач.

Дальше картинки с минимумом коментариев, в принципе все ясно....

## Создание инстанса 

![master07](sber1/adv01.png "Мастер 07")

![master07](sber1/adv02.png "Мастер 07")

![master07](sber1/adv03.png "Мастер 07")

![master07](sber1/adv04.png "Мастер 07")

## Свод параметров нового истанса

![master07](sber1/adv05.png "Мастер 07")

## Прогресс создания

![master07](sber1/adv06.png "Мастер 07")

## Выделение IP

![master07](sber1/adv07.png "Мастер 07")

![master07](sber1/adv08.png "Мастер 07")

## Привязка к кластеру БД

![master07](sber1/adv09.png "Мастер 07")

## Создание новой группы безопасности (Security Group)

![master07](sber1/adv10.png "Мастер 07")

![master07](sber1/adv11.png "Мастер 07")

![master07](sber1/adv12.png "Мастер 07")

## Топология

![master07](sber1/adv14.png "Мастер 07")

## Проверка доступности

![master07](sber1/adv15.png "Мастер 07")

## Работа с сервером БД

![master07](sber1/adv16.png "Мастер 07")

![master07](sber1/adv17.png "Мастер 07")

## Список БД в консоли

![master07](sber1/adv18.png "Мастер 07")

## Логи БД

![master07](sber1/adv19.png "Мастер 07")

## Большой выбор плагинов для Postgresql

![master07](sber1/adv20.png "Мастер 07")

## Доступные операции на инстансе

![master07](sber1/adv21.png "Мастер 07")

## Создание read-only реплики

![master07](sber1/adv22.png "Мастер 07")

![master07](sber1/adv23.png "Мастер 07")

![master07](sber1/adv24.png "Мастер 07")

![master07](sber1/adv25.png "Мастер 07")

## Переключение мастера

![master07](sber1/adv26.png "Мастер 07")

## Топология

![master07](sber1/adv27.png "Мастер 07")

Публикуем реплику

![master07](sber1/adv28.png "Мастер 07")

## Проверяем реплику

![master07](sber1/adv29.png "Мастер 07")

## Работа закончена
